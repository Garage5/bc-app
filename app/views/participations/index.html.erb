<% stylesheet :participants %>
<% body 'participants' %>
<% title @tournament.name %>

<% content_for :tournament_nav do -%>
  <%= render :partial => "layouts/sub_nav", :locals => {:active => 'participants'} %>
<% end -%>

<div id="maincol">
	<div class="col">
	<div class="pod tab-pod">
		<div class="hd">
			<h2>Officials</h2>
			<ul class="tabbed clear">
				<li class="create_team active"><a class="rc" href="#add_cohost" rel="modal">Add a Co-Host</a></li>
			</ul>
		</div>
	<% if flash[:error] %>
    <div class="note red_note global_note">
	    <p><%= flash[:error] %><a class="note-close" href="">X</a></p>
    </div>
  <% end %>
	<div class="bd clear player_list">
		<ul class="clear">
		  <!-- host -->
			<li class="clear">
				<div class="user_avatar">
					<a class="avatar" href=""><img src="/images/avatar_big.jpg" /></a>
				</div>
				<div class="user_name">
					<h2><%= @tournament.instance.host.login %></h2>
					<p class="role">Host</p>
					<p class="activity">Last activity 1 day ago</p>
				</div><!-- / user_name -->
				<a class="user_edit" rel="modal" href="#team_invite">Edit</a>
			</li>
			<!-- cohosts -->
			<% @tournament.cohosts.each do |cohost| %>
			  <li class="clear">
				  <div class="user_avatar">
					  <a class="avatar" href=""><img src="/images/avatar_big.jpg" /></a>
				  </div>
				  <div class="user_name">
					  <h2><%= cohost.login %></h2>
					  <p class="role">Co-Host</p>
					  <p class="activity">Last activity 1 day ago</p>
				  </div><!-- / user_name -->
				  <a class="user_edit" rel="modal" href="#team_invite">Edit</a>
			  </li>
			<% end %>
		</ul>
		
	</div><!-- / bd -->
	</div><!-- / pod -->
	
	<div class="pod tab-pod">
		<div class="hd">
			<h2>Participants</h2>
			<ul class="tabbed clear">
				<li class="create_team active"><a class="rc" href="#create_team" rel="modal">Create a Team</a></li>
			</ul>
		</div>
	<div class="bd clear player_list">
	  <ul class="clear" id="active_participants">
	    <% for participant in @tournament.active_participants %>
        <%= render :partial => 'participant', :locals => {:participant => participant} %>
	    <% end %>
		</ul>
	</div><!-- / bd -->
	</div><!-- / pod -->
	
	<% if current_user %>
	<% if current_user.is_hosting?(@tournament) %>
	
	<script type="text/javascript" charset="utf-8">
	  $(document).ready(function(){
	    // Approve Participants
	    $("button#approve").click(function() {
        $("form#pending_participants").attr('action', '<%= accept_tournament_participants_path(@tournament) %>');
        $("form#pending_participants").submit(function(){
          serialized = $(this).serializeArray();
          serialized.push({name: "_method", value: "put"})
          $.post(this.action, serialized, null, "script");
          return false;
        });
      })
      
      // Deny Participants
      $("button#deny").click(function() {
        $("form#pending_participants").attr('action', '<%= deny_tournament_participants_path(@tournament) %>');
        $("form#pending_participants").submit(function(){
          serialized = $(this).serializeArray();
          serialized.push({name: "_method", value: "delete"})
          $.post(this.action, serialized, null, "script");
          return false;
        });
      })
	  })
	</script>
	
	<div class="pod">
		<div class="hd">
			<h2>Pending Approval</h2>
		</div>
	<div class="bd clear player_list pending_players">
    
    <% if !@pending_participants.blank? %>
      <% form_tag '', :id => 'pending_participants' do %>
        <ul class="clear">
        <% for p in @tournament.pending_participants %>
          <li class="clear" id="user-<%= p.id %>">
    				<p class="approve_checkbox"><%= check_box_tag "participants[#{p.id}]" %></p>
    				<div class="user_avatar">
    					<a class="avatar" href=""><img src="/images/avatar_big.jpg" /></a>
    				</div>
    				<div class="user_name">
    					<h2><%= p.login %></h2>
    					<p class="activity">Last activity 1 day ago</p>		
    				</div><!-- / user_name -->
    				<a class="user_edit" href="">Edit</a>
    			</li>
        <% end %>
        </ul>
      <div class="btn_wrapper">
        <button type="submit" class="btn" id="approve"><span class="icon"></span><span>Approve Selected</span></button>
        <a href="#deny_participation" class="btn" id="deny" rel="modal">Decline Selected</a>
      </div>
      <% end %>
    <% else %>
      No Pending Participants
    <% end %>
    
	</div><!-- / bd -->
	</div><!-- / pod -->
  <% end %>
  <% end %>
	</div><!-- / col -->
</div><!-- / main-col -->
